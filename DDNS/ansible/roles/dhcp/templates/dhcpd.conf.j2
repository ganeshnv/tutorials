option domain-name "example.com";
option domain-name-servers 192.168.0.100;
default-lease-time 600;
max-lease-time 7200;

authoritative;

ddns-update-style interim;
update-static-leases on;

allow booting;
allow bootp;
allow unknown-clients;

log-facility local7;


key dhcp_updater {
  algorithm hmac-md5;
  secret kJXeaOPPGtoko0KKwTfCZg==;
}

{% for domain in configuration.dhcp %}

zone {{ domain['subnet']| ipaddr('revdns') }} {
  primary {{ domain['name_server'] }};
  key dhcp_updater;
}

zone {{ domain['domain'] }} {
  primary {{ domain['name_server'] }};
  key dhcp_updater;
}

subnet {{ domain['subnet']| ipaddr('network') }} netmask {{ domain['subnet']| ipaddr('netmask') }} {
  option broadcast-address {{ domain['subnet']| ipaddr('broadcast') }};
  option routers {{ domain['gateway'] }};
  option domain-name "{{ domain['domain'] }}";
  option domain-name-servers {{ domain['name_server'] }};

  # Known Client
  pool {
    range {{ domain['known_pool']|ipaddr('network') }} {{ domain['known_pool']|ipaddr('broadcast') }};
    deny unknown clients;
  }
  
  # unKnown Client
  pool {
     range {{ domain['unknown_pool']|ipaddr('network') }} {{ domain['unknown_pool']|ipaddr('broadcast') }};
    allow unknown clients;
    ddns-hostname = concat("system",binary-to-ascii(10, 8, "-", suffix(leased-address,1)));
    ddns-domainname = "example.com";
  }
  next-server 192.168.0.100;
  filename "/pxelinux.0";
}
{% endfor %}
